const data = [
    {
        "ms": "TC",
        "ms_name": "Interreg",
        "fund": "TOTAL",
        "year": 2021,
        "planned_eu_amount": 9410256783,
        "n_3_decommitment_amount": -1306860,
        "net_planned_eu_amount": 9408949923,
        "cumulative_initial_pre_financing": 277009954.59,
        "cumulative_additional_initial_pre_financing": 0,
        "recovery_of_initial_pre_financing": 0,
        "net_initial_pre_financing": 277009954.59,
        "cumulative_annual_pre_financing": 1425146510.54,
        "annual_pre_financing_covered_by_expenditure": 273242344.24,
        "recovery_of_annual_pre_financing": 793378204.08,
        "net_annual_pre_financing": 358525962.22,
        "cumulative_interim_payment": 4997782236.19,
        "recovery_of_expense": 4078814.76,
        "net_interim_payment": 5266945765.67,
        "total_net_payment": 5902481682.48,
        "eu_payment_rate": 62.7326293665512,
        "eu_payment_rate_on_planned_eu_amount": 62.7239173020556
    },
    {
        "ms": "RO",
        "ms_name": "Romania",
        "fund": "ERDF",
        "year": 2023,
        "planned_eu_amount": 12376137876,
        "n_3_decommitment_amount": 0,
        "net_planned_eu_amount": 12376137876,
        "cumulative_initial_pre_financing": 868546842.66,
        "cumulative_additional_initial_pre_financing": 0,
        "recovery_of_initial_pre_financing": 0,
        "net_initial_pre_financing": 868546842.66,
        "cumulative_annual_pre_financing": 2048832083.97,
        "annual_pre_financing_covered_by_expenditure": 502203928.85,
        "recovery_of_annual_pre_financing": 1077148628.61,
        "net_annual_pre_financing": 1338026369.17,
        "cumulative_interim_payment": 9459260360.08,
        "recovery_of_expense": 11907266.25,
        "net_interim_payment": 9949557022.68,
        "total_net_payment": 11287583391.85,
        "eu_payment_rate": 91.2044088789529,
        "eu_payment_rate_on_planned_eu_amount": 91.2044088789529
    },
    {
        "ms": "TC",
        "ms_name": "Interreg",
        "fund": "ERDF",
        "year": 2021,
        "planned_eu_amount": 9410256783,
        "n_3_decommitment_amount": -1306860,
        "net_planned_eu_amount": 9408949923,
        "cumulative_initial_pre_financing": 277009954.59,
        "cumulative_additional_initial_pre_financing": 0,
        "recovery_of_initial_pre_financing": 0,
        "net_initial_pre_financing": 277009954.59,
        "cumulative_annual_pre_financing": 1425146510.54,
        "annual_pre_financing_covered_by_expenditure": 273242344.24,
        "recovery_of_annual_pre_financing": 793378204.08,
        "net_annual_pre_financing": 635535916.809999,
        "cumulative_interim_payment": 4997782236.19,
        "recovery_of_expense": 4078814.76,
        "net_interim_payment": 5266945765.67,
        "total_net_payment": 5902481682.48,
        "eu_payment_rate": 62.7326293665512,
        "eu_payment_rate_on_planned_eu_amount": 62.7239173020556
    },
    {
        "ms": "NL",
        "ms_name": "Netherlands",
        "fund": "ERDF",
        "year": 2023,
        "planned_eu_amount": 791056051,
        "n_3_decommitment_amount": 0,
        "net_planned_eu_amount": 791056051,
        "cumulative_initial_pre_financing": 47368625.97,
        "cumulative_additional_initial_pre_financing": 0,
        "recovery_of_initial_pre_financing": 0,
        "net_initial_pre_financing": 47368625.97,
        "cumulative_annual_pre_financing": 109683026.38,
        "annual_pre_financing_covered_by_expenditure": 29936191.64,
        "recovery_of_annual_pre_financing": 56352761.21,
        "net_annual_pre_financing": 70762699.5,
        "cumulative_interim_payment": 492457164.67,
        "recovery_of_expense": 0,
        "net_interim_payment": 522393356.31,
        "total_net_payment": 593156055.81,
        "eu_payment_rate": 74.9828100120304,
        "eu_payment_rate_on_planned_eu_amount": 74.9828100120304
    },
    {
        "ms": "FI",
        "ms_name": "Finland",
        "fund": "ERDF",
        "year": 2023,
        "planned_eu_amount": 911500186,
        "n_3_decommitment_amount": 0,
        "net_planned_eu_amount": 911500186,
        "cumulative_initial_pre_financing": 36354536.76,
        "cumulative_additional_initial_pre_financing": 0,
        "recovery_of_initial_pre_financing": 0,
        "net_initial_pre_financing": 36354536.76,
        "cumulative_annual_pre_financing": 145781633.4,
        "annual_pre_financing_covered_by_expenditure": 50489421.84,
        "recovery_of_annual_pre_financing": 66551480.54,
        "net_annual_pre_financing": 65095267.78,
        "cumulative_interim_payment": 746086862.62,
        "recovery_of_expense": 0,
        "net_interim_payment": 796576284.46,
        "total_net_payment": 861671552.24,
        "eu_payment_rate": 94.5333380590226,
        "eu_payment_rate_on_planned_eu_amount": 94.5333380590226
    },    
    {
        "ms": "LV",
        "ms_name": "Latvia",
        "fund": "CF",
        "year": 2023,
        "planned_eu_amount": 1246634592,
        "n_3_decommitment_amount": 0,
        "net_planned_eu_amount": 1246634592,
        "cumulative_initial_pre_financing": 38053494.39,
        "cumulative_additional_initial_pre_financing": 0,
        "recovery_of_initial_pre_financing": 0,
        "net_initial_pre_financing": 38053494.39,
        "cumulative_annual_pre_financing": 242867675.75,
        "annual_pre_financing_covered_by_expenditure": 26728833.24,
        "recovery_of_annual_pre_financing": 157051202.55,
        "net_annual_pre_financing": 97141134.35,
        "cumulative_interim_payment": 932556402.72,
        "recovery_of_expense": 1582884.99,
        "net_interim_payment": 957702350.97,
        "total_net_payment": 1054843485.32,
        "eu_payment_rate": 84.6152908068831,
        "eu_payment_rate_on_planned_eu_amount": 84.6152908068831
    }, 
    {
        "ms": "FI",
        "ms_name": "Finland",
        "fund": "TOTAL",
        "year": 2023,
        "planned_eu_amount": 911500186,
        "n_3_decommitment_amount": 0,
        "net_planned_eu_amount": 911500186,
        "cumulative_initial_pre_financing": 36354536.76,
        "cumulative_additional_initial_pre_financing": 0,
        "recovery_of_initial_pre_financing": 0,
        "net_initial_pre_financing": 36354536.76,
        "cumulative_annual_pre_financing": 145781633.4,
        "annual_pre_financing_covered_by_expenditure": 50489421.84,
        "recovery_of_annual_pre_financing": 66551480.54,
        "net_annual_pre_financing": 28740731.02,
        "cumulative_interim_payment": 746086862.62,
        "recovery_of_expense": 0,
        "net_interim_payment": 796576284.46,
        "total_net_payment": 861671552.24,
        "eu_payment_rate": 94.5333380590226,
        "eu_payment_rate_on_planned_eu_amount": 94.5333380590226
    },
    {
        "ms": "RO",
        "ms_name": "Romania",
        "fund": "TOTAL",
        "year": 2023,
        "planned_eu_amount": 18911134853,
        "n_3_decommitment_amount": 0,
        "net_planned_eu_amount": 18911134853,
        "cumulative_initial_pre_financing": 1129302729.02,
        "cumulative_additional_initial_pre_financing": 0,
        "recovery_of_initial_pre_financing": 0,
        "net_initial_pre_financing": 1129302729.02,
        "cumulative_annual_pre_financing": 3304685776.16,
        "annual_pre_financing_covered_by_expenditure": 801498614.69,
        "recovery_of_annual_pre_financing": 1729543863.68,
        "net_annual_pre_financing": 773643297.79,
        "cumulative_interim_payment": 15130042993.6,
        "recovery_of_expense": 11907266.25,
        "net_interim_payment": 15919634342.04,
        "total_net_payment": 17822580368.85,
        "eu_payment_rate": 94.2438436793373,
        "eu_payment_rate_on_planned_eu_amount": 94.2438436793373
    },
    {
        "ms": "PL",
        "ms_name": "Poland",
        "fund": "TOTAL",
        "year": 2021,
        "planned_eu_amount": 64879004975,
        "n_3_decommitment_amount": 0,
        "net_planned_eu_amount": 64879004975,
        "cumulative_initial_pre_financing": 1943386912.05,
        "cumulative_additional_initial_pre_financing": 0,
        "recovery_of_initial_pre_financing": 0,
        "net_initial_pre_financing": 1943386912.05,
        "cumulative_annual_pre_financing": 9174735397.44,
        "annual_pre_financing_covered_by_expenditure": 2451786154.8,
        "recovery_of_annual_pre_financing": 4528755140.49,
        "net_annual_pre_financing": 2194194102.15,
        "cumulative_interim_payment": 43093589060.6,
        "recovery_of_expense": 103369931.05,
        "net_interim_payment": 45442005284.35,
        "total_net_payment": 49579586298.55,
        "eu_payment_rate": 76.4185368096422,
        "eu_payment_rate_on_planned_eu_amount": 76.4185368096422
    },
    {
        "ms": "ES",
        "ms_name": "Spain",
        "fund": "ERDF",
        "year": 2024,
        "planned_eu_amount": 29101440102,
        "n_3_decommitment_amount": -2111646,
        "net_planned_eu_amount": 29099328456,
        "cumulative_initial_pre_financing": 1684672125.11,
        "cumulative_additional_initial_pre_financing": 0,
        "recovery_of_initial_pre_financing": 21531983.27,
        "net_initial_pre_financing": 1663140141.84,
        "cumulative_annual_pre_financing": 3957618233.99,
        "annual_pre_financing_covered_by_expenditure": 885647559.69,
        "recovery_of_annual_pre_financing": 2113635928.38,
        "net_annual_pre_financing": 2621474887.76,
        "cumulative_interim_payment": 18921672906.51,
        "recovery_of_expense": 205667492.77,
        "net_interim_payment": 19601652973.43,
        "total_net_payment": 22223127861.19,
        "eu_payment_rate": 76.3698993768628,
        "eu_payment_rate_on_planned_eu_amount": 76.3643578575437
    },
    {
        "ms": "PL",
        "ms_name": "Poland",
        "fund": "CF",
        "year": 2023,
        "planned_eu_amount": 23139930966,
        "n_3_decommitment_amount": 0,
        "net_planned_eu_amount": 23139930966,
        "cumulative_initial_pre_financing": 654465290.97,
        "cumulative_additional_initial_pre_financing": 0,
        "recovery_of_initial_pre_financing": 0,
        "net_initial_pre_financing": 654465290.97,
        "cumulative_annual_pre_financing": 4278864643.08,
        "annual_pre_financing_covered_by_expenditure": 1766188362.8,
        "recovery_of_annual_pre_financing": 1672423470.16,
        "net_annual_pre_financing": 1494718101.09,
        "cumulative_interim_payment": 19879218152.72,
        "recovery_of_expense": 193650.61,
        "net_interim_payment": 21645212864.91,
        "total_net_payment": 23139930966,
        "eu_payment_rate": 100,
        "eu_payment_rate_on_planned_eu_amount": 100
    },
    {
        "ms": "DE",
        "ms_name": "Germany",
        "fund": "ERDF",
        "year": 2021,
        "planned_eu_amount": 11935900615,
        "n_3_decommitment_amount": 0,
        "net_planned_eu_amount": 11935900615,
        "cumulative_initial_pre_financing": 433390687.37,
        "cumulative_additional_initial_pre_financing": 0,
        "recovery_of_initial_pre_financing": 0,
        "net_initial_pre_financing": 433390687.37,
        "cumulative_annual_pre_financing": 1566948256.07,
        "annual_pre_financing_covered_by_expenditure": 295221665.66,
        "recovery_of_annual_pre_financing": 847985689.92,
        "net_annual_pre_financing": 857131587.86,
        "cumulative_interim_payment": 5482316726.95,
        "recovery_of_expense": 1748307.95,
        "net_interim_payment": 5775790084.66,
        "total_net_payment": 6632921672.52,
        "eu_payment_rate": 55.5711871811694,
        "eu_payment_rate_on_planned_eu_amount": 55.5711871811694
    },
    {
        "ms": "ES",
        "ms_name": "Spain",
        "fund": "TOTAL",
        "year": 2024,
        "planned_eu_amount": 29101440102,
        "n_3_decommitment_amount": -2111646,
        "net_planned_eu_amount": 29099328456,
        "cumulative_initial_pre_financing": 1684672125.11,
        "cumulative_additional_initial_pre_financing": 0,
        "recovery_of_initial_pre_financing": 21531983.27,
        "net_initial_pre_financing": 1663140141.84,
        "cumulative_annual_pre_financing": 3957618233.99,
        "annual_pre_financing_covered_by_expenditure": 885647559.69,
        "recovery_of_annual_pre_financing": 2113635928.38,
        "net_annual_pre_financing": 2621474887.76,
        "cumulative_interim_payment": 18921672906.51,
        "recovery_of_expense": 205667492.77,
        "net_interim_payment": 19601652973.43,
        "total_net_payment": 22223127861.19,
        "eu_payment_rate": 76.3698993768628,
        "eu_payment_rate_on_planned_eu_amount": 76.3643578575437
    },
    
    {
        "ms": "LU",
        "ms_name": "Luxembourg",
        "fund": "ERDF",
        "year": 2023,
        "planned_eu_amount": 89189782,
        "n_3_decommitment_amount": 0,
        "net_planned_eu_amount": 39099328456,
        "cumulative_initial_pre_financing": 11003074.62,
        "cumulative_additional_initial_pre_financing": 0,
        "recovery_of_initial_pre_financing": 0,
        "net_initial_pre_financing": 11003074.62,
        "cumulative_annual_pre_financing": 6386663.66,
        "annual_pre_financing_covered_by_expenditure": 2902451.64,
        "recovery_of_annual_pre_financing": 1505632.02,
        "net_annual_pre_financing": 12981654.62,
        "cumulative_interim_payment": 66370779.13,
        "recovery_of_expense": 830013.35,
        "net_interim_payment": 68443217.42,
        "total_net_payment": 81424872.04,
        "eu_payment_rate": 91.2939466989615,
        "eu_payment_rate_on_planned_eu_amount": 91.2939466989615
    },


    {
        "ms": "LU",
        "ms_name": "Luxembourg",
        "fund": "TOTAL",
        "year": 2023,
        "planned_eu_amount": 89189782,
        "n_3_decommitment_amount": 0,
        "net_planned_eu_amount": 30099328456,
        "cumulative_initial_pre_financing": 11003074.62,
        "cumulative_additional_initial_pre_financing": 0,
        "recovery_of_initial_pre_financing": 0,
        "net_initial_pre_financing": 11003074.62,
        "cumulative_annual_pre_financing": 6386663.66,
        "annual_pre_financing_covered_by_expenditure": 2902451.64,
        "recovery_of_annual_pre_financing": 1505632.02,
        "net_annual_pre_financing": 12981654.62,
        "cumulative_interim_payment": 66370779.13,
        "recovery_of_expense": 830013.35,
        "net_interim_payment": 68443217.42,
        "total_net_payment": 81424872.04,
        "eu_payment_rate": 91.2939466989615,
        "eu_payment_rate_on_planned_eu_amount": 91.2939466989615
    },

    {
        "ms": "ET",
        "ms_name": "Estonia",
        "fund": "TOTAL",
        "year": 2022,
        "planned_eu_amount": 29101440102,
        "n_3_decommitment_amount": -2111646,
        "net_planned_eu_amount": 29099328456,
        "cumulative_initial_pre_financing": 1684672125.11,
        "cumulative_additional_initial_pre_financing": 0,
        "recovery_of_initial_pre_financing": 21531983.27,
        "net_initial_pre_financing": 1663140141.84,
        "cumulative_annual_pre_financing": 3957618233.99,
        "annual_pre_financing_covered_by_expenditure": 885647559.69,
        "recovery_of_annual_pre_financing": 2113635928.38,
        "net_annual_pre_financing": 2621474887.76,
        "cumulative_interim_payment": 18921672906.51,
        "recovery_of_expense": 205667492.77,
        "net_interim_payment": 19601652973.43,
        "total_net_payment": 22223127861.19,
        "eu_payment_rate": 76.3698993768628,
        "eu_payment_rate_on_planned_eu_amount": 76.3643578575437
    },

    {
        "ms": "ET",
        "ms_name": "Estonia",
        "fund": "ERDF",
        "year": 2022,
        "planned_eu_amount": 29101440102,
        "n_3_decommitment_amount": -2111646,
        "net_planned_eu_amount": 29099328456,
        "cumulative_initial_pre_financing": 1684672125.11,
        "cumulative_additional_initial_pre_financing": 0,
        "recovery_of_initial_pre_financing": 21531983.27,
        "net_initial_pre_financing": 1663140141.84,
        "cumulative_annual_pre_financing": 3957618233.99,
        "annual_pre_financing_covered_by_expenditure": 885647559.69,
        "recovery_of_annual_pre_financing": 2113635928.38,
        "net_annual_pre_financing": 2621474887.76,
        "cumulative_interim_payment": 18921672906.51,
        "recovery_of_expense": 205667492.77,
        "net_interim_payment": 19601652973.43,
        "total_net_payment": 22223127861.19,
        "eu_payment_rate": 76.3698993768628,
        "eu_payment_rate_on_planned_eu_amount": 76.3643578575437
    }
]



const API_BASE = "/api/v2";

function loadBackend_isabel (app, db) {

    db.insert(data);

    //DOCUMENTATION IN POSTMAN
    app.get(API_BASE + "/structural-payment-data/docs", (req, res) => {
        console.log(`REDIRECT TO structural-payment-data/docs`);
        res.status(301).redirect("https://documenter.getpostman.com/view/32944023/2sA35G21ac")
    
    });

    //GET - PAGINATION,SEARCH BY FIELDS AND PERIOD
    app.get(API_BASE + "/structural-payment-data", (req, res) => {

        const queryParameters = req.query;
        const limit = parseInt(queryParameters.limit) || 20;
        const offset = parseInt(queryParameters.offset) || 0;
        let from = req.query.from;
        let to = req.query.to;
    
        //Check for 'from' and 'to' parameters
        if (from !== undefined && to !== undefined) {
            const fromYear = parseInt(from);
            const toYear = parseInt(to);
            if (isNaN(fromYear) || isNaN(toYear)) {
                console.error("Invalid year format. Please provide valid year values.")
                return  res.sendStatus(400, "Bad Request"); 
            }
            //If the years are valid, build the query to filter by the year range
            queryParameters.year = { $gte: fromYear, $lte: toYear };
        }
    
        let query = {};
        //Build the query based on the provided parameters
        Object.keys(queryParameters).forEach(key => {
            if (key !== 'limit' && key !== 'offset' && key !== 'from' && key !== 'to') {
                const value = !isNaN(queryParameters[key]) ? parseFloat(queryParameters[key]) : queryParameters[key];
                if (typeof value === 'string') {
                    query[key] = new RegExp(value, 'i');
                } else {
                    query[key] = value;
                }
            }
        });
    
        //Check if search parameters were provided
        const hasSearchParameters = Object.keys(queryParameters).some(key => key !== 'limit' && key !== 'offset' && key !== 'from' && key !== 'to');
    
        if (!hasSearchParameters) {
            db.count({}, (err, count) => {
                if (err) {
                    console.error("Database error:", err);
                    res.sendStatus(500, "Internal Error");
                    return ;
                } else {
                    if (count === 0) {
                        console.error("If there is no data, we return an empty list.");
                        res.status(200).json([]);
                    } else {
                        db.find({}).skip(offset).limit(limit).exec((err, data) => {
                            if (err) {
                                console.error("Error when inserting data:", err);
                                res.sendStatus(500, "Internal Error");
                                return ;
                            } else {
                                const resultsWithoutId = data.map(d => { // Delete default generated id
                                    const { _id, ...datWithoutId } = d;
                                    return datWithoutId;
                                });
                                console.log("Sending the data");
                                res.status(200).json(resultsWithoutId);
                            }
                        });
                    }
                }
            });
        } else {
            db.find(query).skip(offset).limit(limit).exec((err, data) => {
                if (err) {
                    console.error("Database error:", err);
                    res.sendStatus(500, "Internal Error");
                    return;
                } else {
                    // Always return an array, even if there's only one data
                    const formattedData = data.map((d) => {
                        const { _id, ...formatted } = d;
                        return formatted;
                    });
                    console.log("Sending the data");
                    res.status(200).json(formattedData);
                }
            });
        }
    });

    //INTRODUCE DATA
    app.get(API_BASE + "/structural-payment-data/loadInitialData", (req, res) => {
        db.count({}, (err, count) => {
            if (err) {
                res.sendStatus(500, "Internal Error");
            } else {
                if (count === 0) {
                    db.insert(data, (err, docs) => {
                        if (err) {
                            res.sendStatus(500, "Internal Error"); 
                        } else {
                            res.sendStatus(200, "Ok"); 
                        }
                    });
                } else {
                    res.sendStatus(400, "Bad Request"); 
                }
            }
        });
    });

   //GET - ACCESS SPECIFIC DATA
   app.get(API_BASE + "/structural-payment-data/:ms_name/:fund", (req, res) => {
    let ms_name = req.params.ms_name;
    let fund = req.params.fund;

    db.find({ ms_name: ms_name, fund:fund }, (err, data) => {
        if (err) {
            console.error("Database error:", err);
            res.sendStatus(500, "Internal Error");
            return;
        }
        if (data.length > 0) {
            const singleData = data[0];
            const { _id, ...formatted } = singleData;
            res.status(200).json(formatted);
        } else {
            console.error("Datos no existentes");
            res.sendStatus(404, "Not found");
        }
    });
});

    //GET - DATA OF A COUNTRY IN A PERIOD OF TIME
    app.get(API_BASE + "/structural-payment-data/:ms_name", (req, res) => {

        let pais = req.params.ms_name;
        let fromDate = req.query.from;
        let toDate = req.query.to;
    
        let query = { ms_name: pais };
        if (fromDate && toDate) {
            query.year = { $gte: parseInt(fromDate), $lte: parseInt(toDate) };
        }
    
        db.find(query, (err, countryData) => {
            if (err) {
                res.status(500).json({ error: "Internal Server Error" });
                return;
            }
            if (countryData.length > 0) {
                const formattedData = countryData.map((c) => {
                    const { _id, ...formatted } = c;
                    return formatted;
                });
                res.status(200).json(formattedData);
            } else {
                res.sendStatus(404, "Not Found");
            }
        });
    });


    //POST - CHECK IF THE DATA ALREADY EXISTS IN THE DATABASE
    app.post(API_BASE + "/structural-payment-data", (req, res) => {
        const newData = req.body;
        const expectedFields = [
            "ms",
            "ms_name",
            "fund",
            "year",
            "planned_eu_amount",
            "n_3_decommitment_amount",
            "net_planned_eu_amount",
            "cumulative_initial_pre_financing",
            "cumulative_additional_initial_pre_financing",
            "recovery_of_initial_pre_financing",
            "net_initial_pre_financing",
            "cumulative_annual_pre_financing",
            "annual_pre_financing_covered_by_expenditure",
            "recovery_of_annual_pre_financing",
            "net_annual_pre_financing",
            "cumulative_interim_payment",
            "recovery_of_expense",
            "net_interim_payment",
            "total_net_payment",
            "eu_payment_rate",
            "eu_payment_rate_on_planned_eu_amount"
        ];
        const receivedFields = Object.keys(newData);
        const isValidData = expectedFields.every(field => receivedFields.includes(field));
    
        if (!isValidData) {
            res.sendStatus(400, "Bad Request");
        } else {
          db.findOne({ ms_name: newData.ms_name }, (err, existingData) => {
            if (err) {
                res.sendStatus(500, "Internal Error");
            } else {
              if (existingData) {
                res.sendStatus(409, "Conflict");
              } else {
                db.insert(newData, (err, insertedData) => {
                  if (err) {
                    res.sendStatus(500, "Internal Error");
                  } else {
                    res.sendStatus(201, "Created");
                  }
                });
              }
            }
          });
        }
      });
      
    //PUT - NOT ALLOWED
    app.put(API_BASE + "/structural-payment-data", (req, res) => {
        let data = req.body;
        res.sendStatus(405, "Method not allowed");
    });

    //DELETE - DELETE ALL DATA
    app.delete(API_BASE + "/structural-payment-data", (req, res) => {
        db.remove({}, {multi:true}, (err, numRemoved)=>{
            if(err){
                res.sendStatus(500, "Internal Error");
                return;
            }else{
                if(numRemoved>=1){
                    res.sendStatus(200, "Ok");
                }else{
                    res.sendStatus(404, "Not found");
                }
            }
        });
    });

    //POST - NOT ALLOWED
    app.post(API_BASE + "/structural-payment-data/:ms_name", (req, res) => {
        const ms_name = req.params.ms_name;
        let data = req.body;
        res.sendStatus(405, "Method Not Allowed");
    });

    //PUT - UPDATE SPECIFIC DATA
    app.put(API_BASE + "/structural-payment-data/:ms_name/:fund", (req, res) => { 
        const fund = req.params.fund;
        const ms_name = req.params.ms_name;
        let data = req.body;
    
        if (!data || Object.keys(data).length === 0 || data.fund !== fund || data.ms_name !== ms_name) {
            console.error("Invalid data");
            res.sendStatus(400, "Bad Request"); 
            return;
        }
    
        db.update({ ms_name: ms_name, fund: fund }, data, {}, (err) => {
            if (err) {
                console.error("Database error:", err);
                res.sendStatus(500, "Internal Error"); 
            } else {
                console.log("Correct update");
                res.sendStatus(200, "Ok"); 
            }
        });
    });

    //DELETE- DELETE SPECIFIC DATA
    app.delete(API_BASE + "/structural-payment-data/:ms_name/:fund", (req, res) => {
        let country = req.params.ms_name;
        let fund = req.params.fund;
        db.remove({"ms_name": country, "fund": fund}, {}, (err, numRemoved)=>{
            if(err){
                res.sendStatus(500, "Internal Error");
            }else{
                if(numRemoved>=1){
                    res.sendStatus("200", "Ok");
                }else{
                    res.sendStatus("404", "Not found");
                }
            }
        });
    });

    

}

export { loadBackend_isabel }